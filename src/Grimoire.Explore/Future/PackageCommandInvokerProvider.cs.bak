using System;
using Grimoire.Explore.Abstractions;
using Grimoire.Explore.Package;

namespace Grimoire.Explore.Infrastructure
{
    internal class PackageCommandInvokerProvider : ICommandInvokerProvider
    {
        public int Order => -1000;
        
        public void OnProvidersExecuting(CommandInvokerProviderContext context)
        {
            if (context == null)
                throw new ArgumentNullException(nameof(context));

            if (context.CommandContext.CommandDescriptor is not PackageCommandDescriptor)
                return;

            var packageContext = new PackageContext(context.CommandContext);
            var invoker = new PackageCommandInvoker(packageContext);
            
            context.Result = invoker;
        }

        public void OnProvidersExecuted(CommandInvokerProviderContext context)
        {
            // Do nothing
        }
    }
}